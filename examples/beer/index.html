<!DOCTYPE html>
<html>
    <head>
        <title>Pixfinder - a JavaScript library for image analysis</title>
        <meta charset="utf-8" />
        <script src="../../src/Pixfinder.js"></script>
        <script src="../../src/Util/Util.js"></script>
        <script src="../../src/Util/Color.js"></script>
        <script src="../../src/Util/Math.js"></script>
        <script src="../../src/Struct/DisjointSet.js"></script>
    </head>
    <body>
        <p>
        What kinds of beer on the photo?<br />
        Pixfinder analyzed this image and signed each glass!
        </p>
        <img id="myImg" width="600" height="400" src="img.jpg" crossOrigin="Anonymous"></img>
        <canvas style="position:relative; " id="canv" width="600" height="400" style="border:1px solid #d3d3d3;"></canvas>
        <p>Photo &copy; <a target="_blank" href="http://500px.com/photo/5114123">Ed Dorroh</a></p>
        <script>
            window.onload = function () {
                var myImg = document.getElementById('myImg');
                var beerTypes = {
                    'fab500': 'Wheat Beer',
                    'de5100': 'Golden Ale',
                    '780001': 'Dark Ale',
                    '000000': 'Stout'
                }

                var canv = document.getElementById("canv"),
                    ctx = canv.getContext("2d");
                ctx.clearRect(0, 0, canv.width, canv.height);

                for (var color in beerTypes) {
                    pixfinder({
                        img: myImg,
                        colors: [color],
                        tolerance: 20,
                        distance: 30,
                        fill: true,
                        clearNoise: 200, // object should contain more than 200 px filled by color
                        onload: function(e) {
                            drawGlasses(e);
                            signGlasses(e, color);
                        }
                    });                    
                }

                function drawGlasses(e) {
                    ctx.fillStyle = Pixfinder.Util.Color.toHex ([
                        Math.random() * 255,
                        Math.random() * 255,
                        Math.random() * 255
                    ]);
                    for (var i = 0; i < e.objects.length; i++) {
                        ctx.beginPath();
                        for (var j = 0; j < e.objects[i].length; j++) {
                            ctx.fillRect(e.objects[i][j].x, e.objects[i][j].y, 1, 1); 
                        };
                        ctx.fill();
                        ctx.closePath();
                    }
                }

                function signGlasses(e, color) {
                    var lastObjPx = e.objects[0][0];
                    ctx.font = "italic bold 12pt Tahoma";
                    ctx.fillStyle = "blue";
                    ctx.fillText(beerTypes[color], lastObjPx.x-20, lastObjPx.y);
                }
            }
        </script>
    </body>
</html>