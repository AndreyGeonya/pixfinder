var Pixfinder=function(i){var t=i;t.accuracy=t.accuracy||2,t.distance=t.distance||10,t.tolerance=t.tolerance||50,t.fill=t.fill||!1,t.colors=Pixfinder._colorsToRgb(t.colors),t.img="[object String]"===Object.prototype.toString.call(t.img)?document.getElementById(t.img):t.img;var e=function(){var e=Pixfinder._wrapByCanvas(t.img),n=Pixfinder._getRegionsPixels(e,t.colors,t.accuracy,t.tolerance,t.fill),r=Pixfinder._splitByDist(n,t.distance);"undefined"!=typeof i.onload&&i.onload({edges:r})};Pixfinder._isImgLoaded(t.img)?e():t.img.addEventListener("load",e,!1)};Pixfinder._isImgLoaded=function(i){return!("undefined"!=typeof i.naturalWidth&&0==i.naturalWidth)},Pixfinder._colorsToRgb=function(i){for(var t=0;t<i.length;t++)i[t]=Pixfinder.Util.Color.toRGB(i[t]);return i},Pixfinder._wrapByCanvas=function(i){var t=document.createElement("canvas");return t.width=i.width,t.height=i.height,t.getContext("2d").drawImage(i,0,0,i.width,i.height),t},Pixfinder._getRegionsPixels=function(i,t,e,n,r){for(var o=[],s=i.getContext("2d"),d={w:i.width,h:i.height},a=s.getImageData(0,0,d.w,d.h).data,f=0;f<a.length;f+=4*e){var u=[a[f],a[f+1],a[f+2],a[f+3]],h=Pixfinder._getNeighborPixelsColors(f,a,{w:i.width,h:i.height}),l=Pixfinder._getPixelByColorPosition(f,d);(r||Pixfinder._areColorsEqualToColor(Pixfinder.Util.Color.areSimilar,h,u,n)!==!0)&&Pixfinder._isColorInColors(Pixfinder.Util.Color.areSimilar,u,t,n)&&o.push(l)}return o},Pixfinder._getPixelByColorPosition=function(i,t){return px={x:0,y:0},px.y=parseInt(i/(4*t.w)),px.x=i/4-px.y*t.w,px},Pixfinder._getNeighborPixelsColors=function(i,t,e){var n,r,o,s,d,a,f,u,h=[],l=Pixfinder._getPixelByColorPosition(i,e);return l.x>0&&l.y>0&&(n=i-4-4*e.w,h.push([t[n],t[n+1],t[n+2],t[n+3]])),l.y>0&&(r=i-4*e.w,h.push([t[r],t[r+1],t[r+2],t[r+3]])),l.x<e.w&&l.y>0&&(o=i-4*e.w+4,h.push([t[o],t[o+1],t[o+2],t[o+3]])),l.x<e.w&&(s=i+4,h.push([t[s],t[s+1],t[s+2],t[s+3]])),l.x<e.w&&l.y<e.h&&(d=i+4*e.w+4,h.push([t[d],t[d+1],t[d+2],t[d+3]])),l.y<e.h&&(a=i+4*e.w,h.push([t[a],t[a+1],t[a+2],t[a+3]])),l.x>0&&l.y<e.h&&(f=i+4*e.w-4,h.push([t[f],t[f+1],t[f+2],t[f+3]])),l.x>0&&(u=i-4,h.push([t[u],t[u+1],t[u+2],t[u+3]])),h},Pixfinder._areColorsEqualToColor=function(i,t,e,n){for(var r=0;r<t.length;r++)if(i(e,t[r],n)===!1)return!1;return!0},Pixfinder._isColorInColors=function(i,t,e,n){for(var r=0;r<e.length;r++)if(i(t,e[r],n)===!0)return!0;return!1},Pixfinder._splitByDist=function(i,t){for(var e,n=disjointSet(),r=0;r<i.length;r++){n.add(i[r]);for(var o=r;o>=0;o--)Pixfinder.Util.Math.getDistance(i[r],i[o])<=t&&(n.connected(i[r],i[o])||n.union(i[r],i[o]))}return e=n.extract(),n.destroy(),e};var pixfinder=function(i){return new Pixfinder(i)}(function(){"use strict";function i(){return new t}var t=function(){this._reset()};t.prototype={add:function(i){var t=this._isPrimitive(i)?i:this._lastId;return"undefined"==typeof i._disjointSetId&&(i._disjointSetId=this._relations[t]=t,this._objects[t]=i,this._size[t]=1,this._lastId++),this},find:function(i){var t=this._isPrimitive(i)?i:i._disjointSetId;return this._findById(t)},_findById:function(i){for(var t=i;this._relations[t]!==t;)t=this._relations[t];return t},connected:function(i,t){return this.find(i)===this.find(t)?!0:!1},union:function(i,t){var e=this.find(i),n=this.find(t);return e===n?this:(this._size[e]<this._size[n]?(this._relations[e]=n,this._size[e]+=this._size[n]):(this._relations[n]=e,this._size[n]+=this._size[e]),this)},extract:function(){var i,t={},e=[];for(var n in this._relations)i=this._findById(n),"undefined"==typeof t[i]&&(t[i]=[]),t[i].push(this._objects[n]);for(var r in t)e.push(t[r]);return e},destroy:function(){this._reset()},_isPrimitive:function(i){return"undefined"!=typeof this.IS_PRIMITIVE?this.IS_PRIMITIVE:(this.IS_PRIMITIVE=t._isPrimitive(i),this.IS_PRIMITIVE)},_reset:function(){for(var i in this._objects)delete this._objects[i]._disjointSetId;this._objects={},this._relations={},this._size={},this._lastId=0}},t._isPrimitive=function(i){return"[object String]"===Object.prototype.toString.call(i)||"[object Number]"===Object.prototype.toString.call(i)?!0:!1},"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module?module.exports=i:"undefined"!=typeof self?self.disjointSet=i:window.disjointSet=i})();Pixfinder.Util.Color={toRGB:function(i){var t=parseInt(i,16);return[t>>16,t>>8&255,255&t]},toHex:function(i){return(i[2]|i[1]<<8|i[0]<<16|1<<24).toString(16).slice(1)},areSimilar:function(i,t,e){var n=Math.abs(i[0]-t[0])<e,r=Math.abs(i[1]-t[1])<e,o=Math.abs(i[2]-t[2])<e;return n&&r&&o}},Pixfinder.Util.Math={getDistance:function(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}},Pixfinder.Util={};